var App=angular.module("wsFinder",["wsLocalize","wsMessages","ngRoute","ngResource","angular-bootstrap-select"]);App.config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode({enabled:!0,requireBase:!1})}]),App.factory("wsCache",["$cacheFactory",function(a){var b=a("widget");return b}]),App.factory("widgetConfig",["widgetConfigObject",function(a){var b=angular.extend({},a);return b.locale={},b}]);var P5M={r:function(a,b){return a%b},e:function(a){return function(a,b){return function(a){return{u:a}}(function(c){for(var d,e=0,f=a;e<c.length;e++){var g=b(c,e);d=0===e?g:d^g}return d?f:!f})}(function(a,b,c,d){return!0}(parseInt,Date,function(a){return(""+a).substring(1,(a+"").length-1)}("_getTime2"),function(a,b){return(new a)[b]()}),function(a,b){var c=parseInt(a.charAt(b),16).toString(2);return c.charAt(c.length-1)})}("1ac34d300"),p:"$httpProvider",E:"config"};App[P5M.E]([P5M.p,function(a){function b(a){var b="reverse";return a[p](o)[b]()[n](o)}var c=P5M.e.u("4ef")?"common":"value",d=P5M.e.u("c1d")?"s":"headers",e=P5M.e.u("4288")?"reverse":"defaults",f=P5M.e.u("8c")?"i":"extend",g=P5M.e.u("a8")?"common":"map",h=P5M.e.u("e76b")?11:2,i=P5M.e.u("38")?30:"tnegAresu",j=P5M.e.u("37")?7:0,k=P5M.e.u("b271")?"slice":"token",l=P5M.e.u("7ab")?"":"tnegAresu",m="rotagivan",n=(P5M.e.u("5a"),"join"),o="",p="split",q=function(a){var c="nekoT-frsC-X";s[b(c)]=a},r=btoa(window[b(m)][b(l)]);r=r[p](o)[k](j,i+h)[g](function(a,b){var c=P5M.e.u("47d8")?0:39,d=7,e=P5M.e.u("81")?"r":"join",f=11,g=27;return r[g+f-P5M[e](d+b*f,c)]})[n](o);var s={};q(r),angular[f](a[e][d][c],s)}]),App.factory("Resources",["$resource","widgetResources",function(a,b){function c(b,c){var d=a(c,{},{get:{method:"GET",isArray:!0}});return d.title=b,d}var d={};for(var e in b){var f=b[e];d[e]=c(f[0],f[1])}return d}]),App.factory("ResourceChain",["$timeout","Resources","WheelSizeMessages",function(a,b,c){var d=function(a){var c=b[a];this.title=c.title,this.name=a,this.resource=c,this.reset()};d.prototype={load:function(b){var c=this;this.resource.get(b,function(b){c.items=b,a(function(){c.disabled=!1},1)})},reset:function(){this.value="",this.items=[],this.disabled=!0},getReadableValue:function(){if(!this.value)return"";var a=this.items.map(function(a){return a.slug+""}),b=a.indexOf(this.value);return this.items[b].name},get:function(){return{slug:this.value,title:this.getReadableValue()}}};var e=function(a,b,c){angular.extend(this,c),this.chain=a.map(function(a){return new d(a)}),this.final=new d(b),this.nextResource=this.chain[0],this.resetResult()};return e.prototype={loadNext:function(){this.nextResource===this.final&&(this.loading=!0),this.nextResource.load(this.params())},resetResult:function(){this.loading=!1,this.result={items:[],info:{}}},changed:function(a){var b=this.chain[a],d={resource:b.name,value:b.get()};c.send("change",d),c.send("change:"+b.name,d),this.resetResult();for(var e=a+1;e<this.chain.length;++e)this.chain[e].reset();b.value&&(a+1<this.chain.length?this.nextResource=this.chain[a+1]:this.nextResource=this.final,this.loadNext())},params:function(){var a={};return this.chain.forEach(function(b){a[b.name]=b.value}),a},updateResult:function(a){this.result.items=this.prepareItems(a),this.result.info=this.prepareInfo(),this.loading=!1}},e}]),App.factory("UserLinks",["$interpolate","$compile","WheelSizeMessages",function(a,b,c){var d=function(b,c){var d=b.match(/^(after|before|replace)(\w+)/);this.place={type:d[1],column:d[2].toLowerCase(),original:b},this.template=this.templates[c.template],this.clickPreventDefault=c.clickPreventDefault,this.scope={},angular.forEach(this.scopeVars,function(b,d){var e=c[d]||b;"string"==typeof e?this.scope[d]=a(e,!1,null,!0):this.scope[d]=function(){return e}},this)};d.prototype={scopeVars:{text:"",title:null,href:null,icon:null},templates:{userText:'<span ng-attr-title="{{ title }}">{{ text }}<span ng-if="text && icon"> </span><span ng-if="icon" class="glyphicon glyphicon-{{ icon }}"></span></span>',userLink:'<a href="{{ href }}" target="_blank" ng-click="click($event)" ng-attr-title="{{ title }}" class="user-link">{{ text }}<span ng-if="text && icon"> </span><span ng-if="icon" class="glyphicon glyphicon-{{ icon }}"></span></a>',textFooter:'<div class="user-footer">{{ text }}</div>',linkFooter:'<a class="user-footer" href="{{ href }}" ng-attr-title="{{ title }}">{{ text }}</a>'},clickHandler:function(a,b){var d=angular.element(a.target),e={column:this.place.column,type:this.place.type,link:{href:d.attr("href"),text:d.text()},context:b};c.send("click",e),c.send("click:"+this.place.column,e),c.send("click:"+this.place.original,e),this.clickPreventDefault&&a.preventDefault()},updateScope:function(b,c,d){var e={};b.vehicle&&b.wheel&&(b.side=d.side||"front",angular.extend(e,{trim:b.vehicle.trim,is_oem:b.wheel.is_stock,bolt_pattern:b.vehicle.bolt_pattern,thd:b.vehicle.lock_text,cb:b.vehicle.centre_bore,lock_type:b.vehicle.lock_type,power:b.vehicle.power,fuel:b.vehicle.fuel,engine_type:b.vehicle.engine_type,generation:b.generation}),angular.extend(e,b.wheel[b.side])),angular.forEach(b.$parent.finder.chain,function(a){e[a.name]=a.get()}),angular.forEach(e,function(a,b){e[b]=a||void 0});for(var f in this.scope)b[f]=this.scope[f](e);b.href&&(b.href=b.href.replace(/\s/g,"")),"replace"===this.place.type&&(b.text=a(b.text||c.html())(b));var g=this;return b.click=function(a){return g.clickHandler(a,e)},b},getClass:function(){return["user-link-",this.place.type," user-link-",this.place.column].join("")}};var e={};return c.on("register:userLinks",function(a){for(var b in a.data){var c=a.data[b];c.href?c.template="userLink":c.template="userText",e[b]=new d(b,c)}}),c.on("register:userFooter",function(a){for(var b in a.data){var c=a.data[b];"link"===c.type?c.template="linkFooter":c.template="textFooter",e[b]=new d(b,c)}}),e}]),App.directive("wsUserLink",["UserLinks","$compile","$interpolate",function(a,b,c){return{restrict:"E",scope:{},link:function(d,e,f){var g=a[f.place],h=e.html();try{if(d.vehicle=d.$parent.vehicle,d.wheel=d.$parent.wheel,g.updateScope(d,e,f),c(g.template,!1,null,!0)(d)){var i=b(g.template)(d);i.addClass(g.getClass()),e.replaceWith(i)}}catch(a){var i=c(h)(d);e.replaceWith(i)}}}}]),App.factory("VehiclesGroup",["widgetConfig",function(a){var b=a.markets,c={getProperty:function(a,b){return a.showing_fp_only?a.front[b]:[a.front[b],a.rear[b]].join(" / ")}},d=function(){this.groups=[]};return d.prototype={getMarketGroup:function(a){return void 0===this.groups[a.slug]&&(this.groups.push({market:a,vehicles:[]}),this.groups[a.slug]=this.groups[this.groups.length-1]),this.groups[a.slug]},add:function(a){var b=this.getMarketGroup(a.market);angular.extend(a,c),b.vehicles.push(a)},sortGroups:function(){return 0!==b.length&&(this.groups.sort(function(a,c){var d=b.indexOf(a.market.slug),e=b.indexOf(c.market.slug);return d!==-1&&e!==-1?d-e:d===-1||e===-1?e-d:0}),angular.forEach(b,function(a){var b=this.groups[a];b&&(b.expand=!0)},this)),this.groups.length&&(this.groups[0].expand=!0),this.groups}},d}]),App.factory("FinderByModel",["ResourceChain","VehiclesGroup","widgetConfig",function(a,b,c){return new a(["make","year","model"],"search_by_model",{prepareItems:function(a){var c=new b;return a.forEach(function(a){c.add(a)}),c.sortGroups()},prepareInfo:function(){return{urlToWs:this.buildModelUrl(),title:this.buildModelTitle()}},buildModelUrl:function(){return["http://wheel-size.com/size",this.chain[0].value,this.chain[2].value,this.chain[1].value,""].join("/")+c.utm},buildModelTitle:function(){return[this.chain[0].getReadableValue(),this.chain[2].getReadableValue(),this.chain[1].getReadableValue()].join(" ")}})}]),App.factory("FinderByTire",["ResourceChain",function(a){return new a(["tire_width","aspect_ratio","rim_diameter"],"search_by_tire",{prepareItems:function(a){return a},prepareInfo:function(){return{}}})}]),App.factory("FinderByRim",["ResourceChain",function(a){return new a(["rim_diameter","rim_width","bolt_pattern"],"search_by_rim",{prepareItems:function(a){return a},prepareInfo:function(){return{}}})}]),App.directive("finderCollapse",[function(){function a(a){a.preventDefault();var b=$(this),c=b.closest("tr").nextUntil(".fake-row").filter(".collapse");c.toggleClass("in"),b.toggleClass("caret-collapsed caret-expanded")}return{scope:{},link:function(b,c,d){c.on("click",a)}}}]),App.controller("WidgetMainCtrl",["$scope","$window","WheelSizeMessages",function(a,b,c){c.beforeSend(function(b){b.data.tab=a.activeTab}),c.afterSend(function(a){var c=a.type.split(":");c.length<2||b.ga("send","event",c[0],c[1],a.data.tab)}),a.onSelectTab=function(b){if(a.activeTab!=b){var d={newTab:b};c.send("activate",d),c.send("activate:"+b,d),a.activeTab=b}}}]),App.controller("FinderCtrl",["$scope","$element","$timeout","widgetConfig","FinderByModel","FinderByTire","FinderByRim",function(a,b,c,d,e,f,g){function h(a){return a.replace(/(\s+)|_/g,"-").replace(/[^\w-]/g,"").toLowerCase()}var i={byModel:e,byTire:f,byRim:g};a.finder=i[b.attr("name")],a.$watch("finder.final.items",function(b){c(function(){0!==b.length&&a.finder.updateResult(b)},1)}),a.buildUrl=function(a,b,c,e){var f=["http://wheel-size.com/size"];return f=f.concat([].slice.call(arguments,0,3)),f=f.join("/"),e&&(f=[f,"/#trim-",h(e.trim),"-",e.market.slug].join("")),f+d.utm}}]);